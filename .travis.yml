language: php
sudo: false
dist: xenial

addons:
  apt:
    #update: true
    packages:
      - python-sphinx
      - python-babel
      - doxygen
      - graphviz
      - ghostscript
      - texlive-latex-base
      - texlive-latex-recommended
      - texlive-latex-extra
      - texlive-fonts-recommended
      - texlive-lang-french
      - texlive-lang-english

env:
    SHOULD_DEPLOY: ""

notifications:
  email: false

php:
  - 7.1

before_script:
  - phpenv config-rm xdebug.ini
  - composer require erebot/buildenv

script:
  - ./travis.sh
  - export SHOULD_DEPLOY=`cat ".deploy"`

deploy:
  local-dir: tmp/output
  provider: pages
  target-branch: master
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: false
  verbose: true
  on:
    all_branches: true
    condition: '-n "$SHOULD_DEPLOY"'
